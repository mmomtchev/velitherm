# Velitherm

[![License: LGPL v3](https://img.shields.io/badge/License-LGPL%20v3-blue.svg)](https://www.gnu.org/licenses/lgpl-3.0)
[![Node.js CI](https://github.com/mmomtchev/velitherm/actions/workflows/node.js.yml/badge.svg)](https://github.com/mmomtchev/velitherm/actions/workflows/node.js.yml)
[![npm version](https://img.shields.io/npm/v/velitherm)](https://www.npmjs.com/package/velitherm)
[![codecov](https://codecov.io/gh/mmomtchev/velitherm/branch/main/graph/badge.svg?token=aU1ATy8HKv)](https://codecov.io/gh/mmomtchev/velitherm)

A library of basic thermodynamics equations for soaring flight.

As used by the weather site https://www.velivole.fr / https://www.meteo.guru

Zero-dependency!

# Installation

    npm install --save velitherm

# Usage

Keep in mind that all equations are numerical approximations of differential equations that have no analytical solutions. The approximations used are the typical weather science approximations which give satisfactory results for temperatures in the range of -40°C to +40°C and air pressures in the range of 1050hPa to 200hPa - which are the typical values in the troposphere.

## Common JS

```js
const velitherm = require('velitherm');

assert(velitherm.altitudeFromPressure(898.746) === 1000);
```

## ECMAScript 6

```js
import * as velitherm from 'velitherm';

assert(velitherm.altitudeFromPressure(898.746) === 1000);
```

## TypeScript

```js
import * as velitherm from 'velitherm';

assert(velitherm.altitudeFromPressure(898.746) === 1000);
```

## Barometric and hypsometric equations

There is no single analytical equation that can be used to give a precise value for the altitude / pressure relationship. In fact, this relationship depends on the full vertical temperature and humidity profile and it is impossible to reduce to a single formula. There are two levels of approximation that are widely used:

*   The barometric formula, which is an ICAO standard and gives a rough value that does not take into account the pressure or the temperature of the day and it is always constant - in aviation it is referred by the callsign **QNH**
*   The hypsometric formula, which is commonly used in weather science and it is a better estimation that takes into account the pressure and the temperature of the day - so it varies from one day to another - in aviation it is referred by the callsign **QFF**

# Example

An air parcel with relative humidify of 75% and temperature of 25°C rises from 0m AMSL to 500m AMSL where the surrounding temperature is 20°C. What is its new relative humidity? What is its new temperature? Has there been condensation and did it form a cloud? Has the ceiling being reached or will the air parcel continue to rise? The pressure of the day is 1017hPa.

Solution:

```ts
import * as velitherm from 'velitherm';

// When the air rises, its specific humidity remains constant
const q = velitherm.specificHumidity(75, 1017, 25);
console.log('Specific humidity = ', Math.round(q), 'g/kg');

// Find the current pressure at 500m AMSL
const P1 = velitherm.pressureFromAltitude(500, 1017, 25);
console.log('Pressure at 500m = ', Math.round(P1), 'hPa');

// Take into account the adiabatic cooling
const T1 = 25 - 500 * velitherm.gamma;
console.log('The new temperature of the air parcel at 500m = ', (T1-25)/2, '°C');

// Compute the new relative humidity of the air parcel at this pressure and temperature
const w1 = velitherm.relativeHumidity(q, P1, T1);
console.log('Relative humidity after rising to 500m = ', Math.round(w1), '%');

// If the air parcel has reached 100% humidity, there is condensation
if (w1 < 100) {
  console.log('No, it did not form a cloud');
} else {
  console.log('Yes, it did form a cloud');
}

if (T1 < 20) {
  console.log('The ceiling has been reached');
} else {
  console.log('The air parcel will continue to rise');
}
```

# API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [velitherm](#velitherm)
*   [G](#g)
*   [Cp](#cp)
*   [L](#l)
*   [gamma](#gamma)
*   [P0](#p0)
*   [T0](#t0)
*   [Rd](#rd)
*   [Rv](#rv)
*   [Md](#md)
*   [Mv](#mv)
*   [R](#r)
*   [altitudeFromStandardPressure](#altitudefromstandardpressure)
    *   [Parameters](#parameters)
*   [pressureFromStandardAltitude](#pressurefromstandardaltitude)
    *   [Parameters](#parameters-1)
*   [altitudeFromPressure](#altitudefrompressure)
    *   [Parameters](#parameters-2)
*   [pressureFromAltitude](#pressurefromaltitude)
    *   [Parameters](#parameters-3)
*   [waterVaporSaturationPressure](#watervaporsaturationpressure)
    *   [Parameters](#parameters-4)
*   [relativeHumidity](#relativehumidity)
    *   [Parameters](#parameters-5)
*   [dewPoint](#dewpoint)
    *   [Parameters](#parameters-6)
*   [relativeHumidityFromDewPoint](#relativehumidityfromdewpoint)
    *   [Parameters](#parameters-7)
*   [mixingRatio](#mixingratio)
    *   [Parameters](#parameters-8)
*   [specificHumidityFromMixingRatio](#specifichumidityfrommixingratio)
    *   [Parameters](#parameters-9)
*   [specificHumidity](#specifichumidity)
    *   [Parameters](#parameters-10)
*   [airDensity](#airdensity)
    *   [Parameters](#parameters-11)
*   [LCL](#lcl)
    *   [Parameters](#parameters-12)
*   [gammaMoist](#gammamoist)
    *   [Parameters](#parameters-13)

## velitherm

velivole.fr/meteo.guru Basic Thermodynamics Equations for Soaring Flight

Copyright © 2022 Momtchil Momtchev <momtchil@momtchev.com>

Licensed under the LGPL License, Version 3.0 (the "License")
You may not use this file except in compliance with the License.
You may obtain a copy of the License at: <https://www.gnu.org/licenses/lgpl-3.0.en.html>

All methods use:

Pressure in hPa

Temperature in °C

Height in meters

Relative humidity in % from 0 to 100

Specific humidity in g/kg

Mixing ratio in g/kg

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

## G

Earth's average gravity acceleration (m/s2)

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## Cp

The thermal capacity of air (J/kg)

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## L

The enthalpy of vaporization of water (J/kg)

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## gamma

The adiabatic lapse rate of dry air (°C/m)

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## P0

The average sea level pressure (hPa)

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## T0

The temperature of the ICAO standard atmosphere (°C)

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## Rd

The specific gas constant of dry air J/(kg\*K)

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## Rv

The specific gas constant of water vapor J/(kg\*K)

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## Md

Molar mass of dry air kg/mol

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## Mv

Molar mass of water vapor kg/mol

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## R

Universal gas constant J/(kg\*mol)

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

## altitudeFromStandardPressure

Altitude from pressure using the barometric formula and ICAO's definition of standard atmosphere.

This is a very rough approximation that is an ICAO standard. It is used when calculating QNH.
It does not take into account the pressure and temperature of the day.

### Parameters

*   `pressure` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Pressure
*   `pressure0` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional sea-level pressure of the day (optional, default `P0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## pressureFromStandardAltitude

Pressure from altitude using the barometric formula and ICAO's definition of standard atmosphere.

This is a very rough approximation that is an ICAO standard. It is used when calculating QNH.
It does not take into account the pressure and temperature of the day.

### Parameters

*   `height` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Height
*   `pressure0` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional sea-level pressure of the day (optional, default `P0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## altitudeFromPressure

Altitude from pressure using the hypsometric formula.

This is a better equation that takes into account the pressure and the temperature of the day.
It is not a standard and different weather institutions use slightly different parameters.
It is used when calculating the QFF.

### Parameters

*   `pressure` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Pressure
*   `pressure0` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional sea-level pressure of the day (optional, default `P0`)
*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional average temperature from the ground to the given level (optional, default `T0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## pressureFromAltitude

Pressure from altitude using the hypsometric formula.

This is a better equation that takes into account the pressure and the temperature of the day.
It is not a standard and different weather institutions use slightly different parameters.
It is used when calculating the QFF.

### Parameters

*   `height` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Height
*   `pressure0` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional sea-level pressure of the day (optional, default `P0`)
*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional average temperature from the ground to the given level (optional, default `T0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## waterVaporSaturationPressure

(Saturation) Water vapor pressure.

Clausius–Clapeyron equation - the most fundamental equation in weather science.

This is the Magnus-Tetens approximation.

### Parameters

*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Temperature (optional, default `T0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## relativeHumidity

Relative humidity from specific humidity.

### Parameters

*   `specificHumidity` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Specific humidity
*   `pressure` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional pressure (optional, default `P0`)
*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional temperature (optional, default `T0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## dewPoint

Dew point from relative humidity.

Approximation of the Magnus equation with the Sonntag 1990 coefficients.

### Parameters

*   `relativeHumidity` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Relative humidity
*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional temperature (optional, default `T0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## relativeHumidityFromDewPoint

Relative humidity from dew point.

Approximation of the Magnus equation with the Sonntag 1990 coefficients.

### Parameters

*   `dewPoint` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Relative humidity
*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional temperature (optional, default `T0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## mixingRatio

Mixing ratio from specific humidity.

### Parameters

*   `specificHumidity` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Specific humidity

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## specificHumidityFromMixingRatio

Specific humidity from mixing ratio.

### Parameters

*   `mixingRatio` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Mixing ratio

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## specificHumidity

Specific humidity from relative humidity.

### Parameters

*   `relativeHumidity` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Relative humidity
*   `pressure` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional pressure (optional, default `P0`)
*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional temperature (optional, default `T0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## airDensity

Air density.

### Parameters

*   `relativeHumidity` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Relative humidity
*   `pressure` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional pressure (optional, default `P0`)
*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional temperature (optional, default `T0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## LCL

Lifted Condensation Level.

This is the altitude at which a mechanically lifted air parcel from the ground will condensate.

It corresponds to the cloud base level when the clouds are formed by mechanical lifting.

This is the Espy equation with the Stull coefficient.

### Parameters

*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Temperature at 2m
*   `dewPoint` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Dew point at 2m

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## gammaMoist

Moist adiabatic lapse rate from pressure and temperature.

(Roland Stull, Practical Meteorology)

### Parameters

*   `temp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Temperature
*   `pressure` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Optional pressure (optional, default `P0`)

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
